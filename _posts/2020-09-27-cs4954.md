---
layout: post
title:  "Getting started with the CS4954"
date:   2020-09-27
---

The CS4954 is an obsolete NTSC/PAL Digital Video Encoder by Cirrus Logic. Despite being out of production, it is a nice chip, and is being used on the [CLONE BUINO DUAL](https://hackaday.io/project/123606-clone-buino-dual) to drive the composite video output.

To get video output on the composite (CVBS) port with minimum effort, these are the steps to take:

- Apply power to the chip
- Provide 27MHz reference clock
- Via I<sub>2</sub>C, change the following control flags (preserve the defaults for other flags and other registers):
    - **CONTROL_0**: Set _MSTR=1_ (Master Mode)
    - **CONTROL_4**: Set _COMDAC_PD=0_ (composite DAC: power up)
    - **CONTROL_5**: Set _EN_COM=1, LOW_IMP=1_ (enable composite DAC, enable composite output)
    - **CONTROL_3**: Set _CBAR=1_ (enable internal color bar generator)
- Note that the default output format is NTSC-M ITU-R.BT601. If that is not OK, you can consult Table 4 of the datasheet which describes register configuration for other formats.

Tip: you might want to make use of [cs4954.h](https://github.com/mcejp/cs4954/blob/master/cs4954.h).

That should be enough to get you the familiar color bars:

![screenshot](../../../images/2020-09-27-cs4954/screenshot.png)
_<center>Here captured through a USB digitizer dongle</center>_

Thanks to Master Mode, we don't have to worry about providing any synchronization signals -- everything is taken care of internally. Those signals will only be needed later, when we want to display our own picture.

Open questions:

- is there a drop-in replacement chip with better availability?
